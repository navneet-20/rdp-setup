name: Free RDP (RustDesk Auto Latest)

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: windows-latest
    timeout-minutes: 360

    steps:
    - name: Set up job
      run: echo "🚀 Starting RustDesk setup..."

    - name: Download Latest RustDesk Release (Windows)
      shell: pwsh
      run: |
        # Get latest release metadata
        $latest = Invoke-RestMethod -Uri "https://api.github.com/repos/rustdesk/rustdesk/releases/latest"
        Write-Host "📦 Latest version: $($latest.tag_name)"
        Write-Host "🔍 Available assets:"
        $latest.assets | ForEach-Object { Write-Host " - $($_.name)" }

        # Try to find Windows build (exe or zip)
        $asset = $latest.assets | Where-Object {
            $_.name -match "pc-windows" -and ($_.name -match "\.exe$" -or $_.name -match "\.zip$")
        } | Select-Object -First 1

        if (-not $asset) {
            Write-Host "❌ No Windows asset found. Dumping asset list for debugging:"
            $latest.assets | ForEach-Object { Write-Host $_.name }
            exit 1
        }

        Write-Host "⬇️ Downloading: $($asset.name)"
        Invoke-WebRequest -Uri $asset.brows
