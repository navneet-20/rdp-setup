name: "Temp File Share"

on:
  workflow_dispatch:

jobs:
  share:
    runs-on: ubuntu-latest
    timeout-minutes: 360

    steps:
      - name: Install tools
        run: |
          sudo apt-get update
          sudo apt-get install -y curl python3-pip
          pip install magic-wormhole

      - name: Start Cloudflare tunnel + wormhole receive server
        run: |
          # Install cloudflared
          curl -L https://github.com/cloudflare/cloudflared/releases/latest/download/cloudflared-linux-amd64.deb -o cloudflared.deb
          sudo dpkg -i cloudflared.deb

          # Start simple HTTP upload server
          mkdir shared
          cd shared
          python3 -m http.server 8000 > server.log 2>&1 &

          sleep 10

          # Start Cloudflare tunnel
          cloudflared tunnel --url http://localhost:8000 > cloudflare.log 2>&1 &

          sleep 20

          echo "=============================="
          echo "üåê OPEN THIS LINK TO DOWNLOAD:"
          grep -o 'https://.*\.trycloudflare\.com' cloudflare.log | head -n 1
          echo "=============================="

          # Keep alive
          sleep 21600
