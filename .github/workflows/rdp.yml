name: Free RDP (RustDesk Latest Auto)

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: windows-latest
    timeout-minutes: 360

    steps:
    - name: Download Latest RustDesk Release
      run: |
        $latest = Invoke-RestMethod -Uri "https://api.github.com/repos/rustdesk/rustdesk/releases/latest"
        $asset = $latest.assets | Where-Object { $_.name -like "*windows*" -and $_.name -like "*.exe" } | Select-Object -First 1
        Invoke-WebRequest -Uri $asset.browser_download_url -OutFile "rustdesk.exe"
        Write-Host "âœ… Downloaded RustDesk version $($latest.tag_name) successfully."

    - name: Run RustDesk
      run: |
        Start-Process -FilePath ".\rustdesk.exe"
        Write-Host "ðŸš€ RustDesk started successfully. Wait a minute, then check its logs for connection details."
        Start-Sleep -Seconds 21600   # Keeps it alive for 6 hours
