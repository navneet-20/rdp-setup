name: "Temp FileBrowser Share"

on:
  workflow_dispatch:

jobs:
  share:
    runs-on: ubuntu-latest
    timeout-minutes: 360

    steps:
      - name: Install dependencies
        run: |
          sudo apt-get update
          sudo apt-get install -y curl

      - name: Download FileBrowser
        run: |
          curl -fsSL https://filebrowser.org/get.sh | bash

      - name: Install cloudflared
        run: |
          curl -L https://github.com/cloudflare/cloudflared/releases/latest/download/cloudflared-linux-amd64.deb -o cloudflared.deb
          sudo dpkg -i cloudflared.deb

      - name: Start FileBrowser + Tunnel
        run: |
          mkdir shared

          # start filebrowser on port 8080
          filebrowser -r ./shared -p 8080 > fb.log 2>&1 &

          sleep 10

          # start cloudflare tunnel
          cloudflared tunnel --url http://localhost:8080 > cloudflare.log 2>&1 &

          sleep 20

          echo "======================================"
          echo "ğŸŒ OPEN THIS LINK:"
          grep -o 'https://.*\.trycloudflare\.com' cloudflare.log | head -n 1
          echo ""
          echo "ğŸ” Login credentials:"
          echo "Username: admin"
          echo "Password: admin"
          echo "======================================"

          # keep runner alive
          sleep 21600
